sequenceDiagram
  autonumber
  participant FE as Frontend
  participant API as Backend API
  participant PLAN as Planner Service
  participant GEO as Google Geocoding
  participant DIR as Google Directions
  participant PLC as Google Places
  participant GEM as Gemini
  participant DB as MongoDB
  participant PDF as PDF Service
  participant S3 as Storage

  FE->>API: POST /v1/trip (JWT, данные поездки)
  API->>PLAN: build plan
  PLAN->>GEO: geocode origin/destination
  PLAN->>DIR: directions (overview_polyline)
  PLAN->>PLC: nearby/details по точкам маршрута
  PLAN->>GEM: prompt → JSON itinerary
  PLAN-->>API: итоговый план
  API->>DB: insert Trip
  API->>PDF: generate PDF
  PDF->>S3: upload
  S3-->>PDF: public URL
  PDF-->>API: pdfUrl
  API-->>FE: 201 {trip, pdfUrl}
